<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="referrer" content="no-referrer"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="keywords" content="Hexo Theme Redefine"><meta name="author" content="Lu"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://registry.npmmirror.com" crossorigin><link rel="canonical" href="https://lusy37.github.io/2024/07/18/httpclient/"><meta name="robots" content="index,follow"><meta name="googlebot" content="index,follow"><meta name="revisit-after" content="1 days"><meta name="description" content="Hexo Theme Redefine, Redefine Your Hexo Journey."><meta property="og:type" content="article"><meta property="og:title" content="HttpClient"><meta property="og:url" content="https://lusy37.github.io/2024/07/18/HttpClient/index.html"><meta property="og:site_name" content="Hexo"><meta property="og:description" content="Hexo Theme Redefine, Redefine Your Hexo Journey."><meta property="og:locale" content="en_US"><meta property="og:image" content="https://lusy37.github.io/images/redefine-og.webp"><meta property="article:published_time" content="2024-07-18T08:42:10.000Z"><meta property="article:modified_time" content="2024-07-18T10:23:54.000Z"><meta property="article:author" content="Lu"><meta property="article:tag" content="工具集"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://lusy37.github.io/images/redefine-og.webp"><link rel="icon" type="image/png" href="/images/redefine-favicon.jpg" sizes="192x192"><link rel="apple-touch-icon" sizes="180x180" href="/images/redefine-favicon.jpg"><meta name="theme-color" content="#A31F34"><link rel="shortcut icon" href="/images/redefine-favicon.jpg"><title>HttpClient | Lusy</title><link rel="stylesheet" href="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/fonts/Chillax/chillax.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/css/build/tailwind.css"><link rel="stylesheet" href="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/fonts/GeistMono/geist-mono.css"><link rel="stylesheet" href="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/fonts/Geist/geist.css"><script src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/libs/anime.min.js"></script><script id="hexo-configurations">window.config={hostname:"lusy37.github.io",root:"/",language:"en",path:"search.xml"},window.theme={articles:{style:{font_size:"16px",line_height:1.5,image_border_radius:"14px",image_alignment:"center",image_caption:!1,link_icon:!0,delete_mask:!1,title_alignment:"left",headings_top_spacing:{h1:"3.2rem",h2:"2.4rem",h3:"1.9rem",h4:"1.6rem",h5:"1.4rem",h6:"1.3rem"}},word_count:{enable:!0,count:!0,min2read:!0},author_label:{enable:!0,auto:!1,list:[]},code_block:{copy:!0,style:"mac",highlight_theme:{light:"github",dark:"vs2015"},font:{enable:!1,family:null,url:null}},toc:{enable:!0,max_depth:6,number:!1,expand:!0,init_open:!0},copyright:{enable:!0,default:"cc_by_nc_sa"},lazyload:!0,pangu_js:!1,recommendation:{enable:!1,title:"推荐阅读",limit:3,mobile_limit:2,placeholder:"/images/wallhaven-wqery6-light.webp",skip_dirs:[]}},colors:{primary:"#A31F34",secondary:null,default_mode:"light"},global:{fonts:{chinese:{enable:!1,family:null,url:null},english:{enable:!1,family:null,url:null},title:{enable:!1,family:null,url:null}},content_max_width:"1000px",sidebar_width:"210px",hover:{shadow:!0,scale:!1},scroll_progress:{bar:!1,percentage:!0},website_counter:{url:"https://cn.vercount.one/js",enable:!0,site_pv:!0,site_uv:!0,post_pv:!0},single_page:!0,preloader:{enable:!0,custom_message:null},open_graph:{enable:!0,image:"/images/redefine-og.webp",description:"Hexo Theme Redefine, Redefine Your Hexo Journey."},google_analytics:{enable:!1,id:null}},home_banner:{enable:!0,style:"fixed",image:{light:"/images/wallhaven-wqery6-light.webp",dark:"/images/wallhaven-wqery6-dark.webp"},title:"等一场花开",subtitle:{text:["迷失的人迷失了，相遇的人再相遇。","迷った人は迷い、出会った人はまた出会う。"],hitokoto:{enable:!1,show_author:!1,api:"https://v1.hitokoto.cn"},typing_speed:100,backing_speed:80,starting_delay:500,backing_delay:1500,loop:!0,smart_backspace:!0},text_color:{light:"#fff",dark:"#d1d1b6"},text_style:{title_size:"2.8rem",subtitle_size:"1.5rem",line_height:1.2},custom_font:{enable:!1,family:null,url:null},social_links:{enable:!1,style:"default",links:{github:null,instagram:null,zhihu:null,twitter:null,email:null},qrs:{weixin:null}}},plugins:{feed:{enable:!1},aplayer:{enable:!1,type:"fixed",audios:[{name:null,artist:null,url:null,cover:null,lrc:null}]},mermaid:{enable:!1,version:"11.4.1"}},version:"2.8.2",navbar:{auto_hide:!1,color:{left:"#f78736",right:"#367df7",transparency:35},width:{home:"1200px",pages:"1000px"},links:{Home:{path:"/",icon:"fa-regular fa-house"},Essays:{path:"/essays",icon:"fa-regular fa-pen-to-square"},Think:{path:"/think",icon:"fa-regular fa-paper-plane"}},search:{enable:!0,preload:!0}},page_templates:{friends_column:2,tags_style:"blur"},home:{sidebar:{enable:!0,position:"left",first_item:"menu",announcement:"If its rainy, you won't see me.If its sunny ,you'll think of me.",show_on_mobile:!0,links:{Archives:{path:"/archives",icon:"fa-regular fa-archive"},Tags:{path:"/tags",icon:"fa-regular fa-tags"},Categories:{path:"/categories",icon:"fa-regular fa-folder"}}},article_date_format:"YYYY-MM-DD",excerpt_length:200,categories:{enable:!0,limit:3},tags:{enable:!0,limit:3}},footerStart:"2024/2/12 15:45:14"},window.lang_ago={second:"%s seconds ago",minute:"%s minutes ago",hour:"%s hours ago",day:"%s days ago",week:"%s weeks ago",month:"%s months ago",year:"%s years ago"},window.data={masonry:!1}</script><link rel="stylesheet" href="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/fontawesome/fontawesome.min.css"><link rel="stylesheet" href="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/fontawesome/brands.min.css"><link rel="stylesheet" href="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/fontawesome/solid.min.css"><link rel="stylesheet" href="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/fontawesome/regular.min.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div class="progress-bar-container"><span class="pjax-progress-bar"></span></div><style>:root{--preloader-background-color:#fff;--preloader-text-color:#000}@media (prefers-color-scheme:dark){:root{--preloader-background-color:#202124;--preloader-text-color:#fff}}@media (prefers-color-scheme:light){:root{--preloader-background-color:#fff;--preloader-text-color:#000}}@media (max-width:600px){.ml13{font-size:2.6rem!important}}.preloader{display:flex;flex-direction:column;gap:1rem;align-items:center;justify-content:center;position:fixed;padding:12px;top:0;right:0;bottom:0;left:0;width:100vw;height:100vh;background-color:var(--preloader-background-color);z-index:1100;transition:opacity .2s ease-in-out}.ml13{font-size:3.2rem;color:var(--preloader-text-color);letter-spacing:-1px;font-weight:500;font-family:Chillax-Variable,sans-serif;text-align:center}.ml13 .word{display:inline-flex;flex-wrap:wrap;white-space:nowrap}.ml13 .letter{display:inline-block;line-height:1em}</style><div class="preloader"><h2 class="ml13">Lusy</h2><script>var textWrapper = document.querySelector('.ml13');
        // Split text into words
        var words = textWrapper.textContent.trim().split(' ');

        // Clear the existing content
        textWrapper.innerHTML = '';

        // Wrap each word and its letters in spans
        words.forEach(function(word) {
            var wordSpan = document.createElement('span');
            wordSpan.classList.add('word');
            wordSpan.innerHTML = word.replace(/\S/g, "<span class='letter'>$&</span>");
            textWrapper.appendChild(wordSpan);
            textWrapper.appendChild(document.createTextNode(' ')); // Add space between words
        });

        var animation = anime.timeline({ loop: true })
            .add({
                targets: '.ml13 .letter',
                translateY: [20, 0],
                translateZ: 0,
                opacity: [0, 1],
                filter: ['blur(5px)', 'blur(0px)'],
                easing: "easeOutExpo",
                duration: 1200,
                delay: (el, i) => 300 + 20 * i,
            })
            .add({
                targets: '.ml13 .letter',
                translateY: [0, -20],
                opacity: [1, 0],
                filter: ['blur(0px)', 'blur(5px)'],
                easing: "easeInExpo",
                duration: 1000,
                delay: (el, i) => 15 * i,
                complete: function() {
                    hidePreloader();
                }
            }, '-=700');


        let themeStatus = JSON.parse(localStorage.getItem('REDEFINE-THEME-STATUS'))?.isDark;

        // If the theme status is not found in local storage, check the preferred color scheme
        if (themeStatus === undefined || themeStatus === null) {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                themeStatus = 'dark';
            } else {
                themeStatus = 'light';
            }
        }

        // Now you can use the themeStatus variable in your code
        if (themeStatus) {
            document.documentElement.style.setProperty('--preloader-background-color', '#202124');
            document.documentElement.style.setProperty('--preloader-text-color', '#fff');
        } else {
            document.documentElement.style.setProperty('--preloader-background-color', '#fff');
            document.documentElement.style.setProperty('--preloader-text-color', '#000');
        }

        window.addEventListener('load', function () {
            setTimeout(hidePreloader, 5000); // Call hidePreloader after 5000 milliseconds if not already called by animation
        });

        function hidePreloader() {
            var preloader = document.querySelector('.preloader');
            preloader.style.opacity = '0';
            setTimeout(function () {
                preloader.style.display = 'none';
            }, 200);
        }</script></div><main class="page-container" id="swup"><div class="main-content-container flex flex-col justify-between min-h-dvh"><div class="main-content-header"><header class="navbar-container px-6 md:px-12"><div class="navbar-content transition-navbar"><div class="left"><a class="logo-title" href="/">Lusy</a></div><div class="right"><div class="desktop"><ul class="navbar-list"><li class="navbar-item"><a href="/"><i class="fa-regular fa-house fa-fw"></i> HOME</a></li><li class="navbar-item"><a href="/essays"><i class="fa-regular fa-pen-to-square fa-fw"></i> ESSAYS</a></li><li class="navbar-item"><a href="/think"><i class="fa-regular fa-paper-plane fa-fw"></i> THINK</a></li><li class="navbar-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i></li></ul></div><div class="mobile"><div class="icon-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i></div><div class="icon-item navbar-bar"><div class="navbar-bar-middle"></div></div></div></div></div><div class="navbar-drawer h-dvh w-full absolute top-0 left-0 bg-background-color flex flex-col justify-between"><ul class="drawer-navbar-list flex flex-col px-4 justify-center items-start"><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full" href="/"><span>HOME </span><i class="fa-regular fa-house fa-sm fa-fw"></i></a></li><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full" href="/essays"><span>ESSAYS </span><i class="fa-regular fa-pen-to-square fa-sm fa-fw"></i></a></li><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full" href="/think"><span>THINK </span><i class="fa-regular fa-paper-plane fa-sm fa-fw"></i></a></li><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full active" href="/archives"><span>Archives</span> <i class="fa-regular fa-archive fa-sm fa-fw"></i></a></li><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full active" href="/tags"><span>Tags</span> <i class="fa-regular fa-tags fa-sm fa-fw"></i></a></li><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full active" href="/categories"><span>Categories</span> <i class="fa-regular fa-folder fa-sm fa-fw"></i></a></li></ul><div class="statistics flex justify-around my-2.5"><a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/tags"><div class="number text-2xl sm:text-xl text-second-text-color font-semibold">8</div><div class="label text-third-text-color text-sm">Tags</div></a><a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/categories"><div class="number text-2xl sm:text-xl text-second-text-color font-semibold">5</div><div class="label text-third-text-color text-sm">Categories</div></a><a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/archives"><div class="number text-2xl sm:text-xl text-second-text-color font-semibold">23</div><div class="label text-third-text-color text-sm">Posts</div></a></div></div><div class="window-mask"></div></header></div><div class="main-content-body transition-fade-up"><div class="main-content"><div class="post-page-container flex relative justify-between box-border w-full h-full"><div class="article-content-container"><div class="article-title relative w-full"><div class="w-full flex items-center pt-6 justify-start"><h1 class="article-title-regular text-second-text-color tracking-tight text-4xl md:text-6xl font-semibold px-2 sm:px-6 md:px-8 py-3">HttpClient</h1></div></div><div class="article-header flex flex-row gap-2 items-center px-2 sm:px-6 md:px-8"><div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]"><img src="/images/redefine-avatar.jpg"></div><div class="info flex flex-col justify-between"><div class="author flex items-center"><span class="name text-default-text-color text-lg font-semibold">Lu</span> <span class="author-label ml-1.5 text-xs px-2 py-0.5 rounded-small text-third-text-color border border-shadow-color-1">Lv3</span></div><div class="meta-info"><div class="article-meta-info"><span class="article-date article-meta-item"><i class="fa-regular fa-pen-fancy"></i>&nbsp; <span class="desktop">2024-07-18 16:42:10</span> <span class="mobile">2024-07-18 16:42:10</span> <span class="hover-info">Created</span> </span><span class="article-date article-meta-item"><i class="fa-regular fa-wrench"></i>&nbsp; <span class="desktop">2024-07-18 18:23:54</span> <span class="mobile">2024-07-18 18:23:54</span> <span class="hover-info">Updated</span> </span><span class="article-categories article-meta-item"><i class="fa-regular fa-folders"></i>&nbsp;<ul><li><a href="/categories/%E5%B7%A5%E5%85%B7%E9%9B%86/">工具集</a>&nbsp;</li></ul></span><span class="article-tags article-meta-item"><i class="fa-regular fa-tags"></i>&nbsp;<ul><li><a href="/tags/%E5%B7%A5%E5%85%B7%E9%9B%86/">工具集</a>&nbsp;</li></ul></span><span class="article-wordcount article-meta-item"><i class="fa-regular fa-typewriter"></i>&nbsp;<span>7.1k Words</span> </span><span class="article-min2read article-meta-item"><i class="fa-regular fa-clock"></i>&nbsp;<span>29 Mins</span> </span><span class="article-pv article-meta-item"><i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span></span></div></div></div></div><div class="article-content markdown-body px-2 sm:px-6 md:px-8 pb-8"><h2 id="HttpClient"><a href="#HttpClient" class="headerlink" title="HttpClient"></a>HttpClient</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>HttpClient 是Apache Jakarta Common 下的子项目，用来提供高效的、最新的、功能丰富的支持HTTP协议的客户端编程工具包，并且它支持HTTP协议最新版本。我们可以使用HttpClient发送各种HTP方法。</p><h3 id="主要特性"><a href="#主要特性" class="headerlink" title="主要特性"></a>主要特性</h3><ol><li><strong>支持HTTP和HTTPS</strong>：实现HTTP1.0&#x2F;1.1，并支持加密的HTTPS协议（SSL）。</li><li><strong>认证方案</strong>：支持多种认证方式（如Basic, Digest, NTLM）及自定义插件认证。</li><li><strong>连接管理</strong>：支持多线程应用，最大连接数设置和过期连接自动关闭。</li><li><strong>自动处理Cookies</strong>：自动管理Set-Cookie头并支持自定义Cookie策略。</li><li><strong>流优化和持久连接</strong>：优化请求&#x2F;响应流，支持HTTP的持久连接（Keep-Alive）。</li></ol><h3 id="简单使用"><a href="#简单使用" class="headerlink" title="简单使用"></a>简单使用</h3><h4 id="HttpGet请求响应的一般步骤："><a href="#HttpGet请求响应的一般步骤：" class="headerlink" title="HttpGet请求响应的一般步骤："></a>HttpGet请求响应的一般步骤：</h4><ul><li><p>创建<code>HttpClient</code>对象，可以使用 <code>HttpClients.createDefault();</code></p></li><li><p>创建Http请求对象：</p><ul><li>如果是无参数的GET请求，则直接使用构造方法 <code>HttpGet(String url)</code> 创建 <code>HttpGet</code> 对象即可。</li><li>如果是带参数的GET请求，则可以先使用 <code>URIBuilder(String url)</code> 创建对象，再调用 <code>addParameter(String param, String value)</code> ，或 <code>setParameter(String param, String value)</code> 来设置请求参数，并调用 <code>build()</code> 方法构建一个URI 对象。只有构造方法 <code>HttpGet(URI uri)</code> 来构建 HttpGet 对象。</li></ul></li><li><p>创建 <code>HttpResponse</code>，调用 <code>HttpClient</code> 对象的 <code>execute(HttpUriRequest request)</code> 发送请求，该方法返回一个 HttpResponse。调用 HttpResponse 的 <code>getAllHeaders()、getHeaders(String name)</code> 等方法可获取服务器的响应头；调用 HttpResponse 的 <code>getEntity()</code> 方法可以获取 HttpEntity 对象，该对象包装了服务器的响应内容；调用 HttpResponse 的 <code>getStatusLine().getStatusCode()</code>获取响应状态码。</p></li><li><p>释放连接，包括 HttpResponse、HttpClient</p></li></ul><h4 id="HttpPost请求响应的一般步骤："><a href="#HttpPost请求响应的一般步骤：" class="headerlink" title="HttpPost请求响应的一般步骤："></a>HttpPost请求响应的一般步骤：</h4><ul><li>创建<code>HttpClient</code>对象，可以使用 <code>HttpClients.createDefault();</code></li><li>创建Http请求对象：<ul><li>如果是无参数的POST请求，则直接通过构造方法 <code>HttpPost(String uri)</code> 创建 <code>HttpPost</code> 对象即可。</li><li>如果是带参数的POST请求，在创建出 <code>HttpPost</code>对象之后，还需要构建一个 <code>HttpEntity</code> 对象（如 StringEntity, UrlEncodedFormEntity ……<strong>entity接口的实现类</strong>）设置请求参数，然后调用 <code>HttpPost.setEntity(HttpEntity entity)</code> 将 <code>HttpEntity</code> 对象添加到请求中。</li></ul></li><li>创建<code>HttpResponse</code> ，调用 <code>HttpClient</code> 对象的 <code>execute(HttpUriRequest request)</code> 发送请求，该方法返回一个 HttpResponse。调用 HttpResponse 的 <code>getAllHeaders()、getHeaders(String name)</code> 等方法可获取服务器的响应头；调用 HttpResponse 的 <code>getEntity()</code> 方法可以获取 HttpEntity 对象，该对象包装了服务器的响应内容；调用 HttpResponse 的 <code>getStatusLine().getStatusCode()</code>获取响应状态码。</li><li>释放连接，包括 HttpResponse、HttpClient</li></ul><h4 id="使用教程"><a href="#使用教程" class="headerlink" title="使用教程"></a>使用教程</h4><ol><li><strong>引入Maven依赖</strong></li></ol><div class="code-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpasyncclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span> <span class="comment">&lt;!-- 请使用最新的稳定版本 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Jackson 依赖，用于 JSON 处理 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div><ol start="2"><li><strong>Java代码示例</strong></li></ol><div class="code-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpClientExamples</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 无参数 GET 请求</span></span><br><span class="line">        sendGetRequestNoParams();</span><br><span class="line">        <span class="comment">// 带参数 GET 请求</span></span><br><span class="line">        sendGetRequestWithParams();</span><br><span class="line">        <span class="comment">// 无参数 POST 请求</span></span><br><span class="line">        sendPostRequestNoParams();</span><br><span class="line">        <span class="comment">// 带参数 POST 请求，使用 User 对象</span></span><br><span class="line">        sendPostRequestWithUser();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 无参数 GET 请求示例</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sendGetRequestNoParams</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClients.createDefault()) &#123;</span><br><span class="line">            <span class="type">HttpGet</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpGet</span>(<span class="string">&quot;http://localhost:8080/posts/1&quot;</span>);</span><br><span class="line">            <span class="type">HttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> httpClient.execute(request);</span><br><span class="line">            System.out.println(<span class="string">&quot;GET No Params Response Status: &quot;</span> </span><br><span class="line">                    + response.getStatusLine().getStatusCode());</span><br><span class="line">            System.out.println(<span class="string">&quot;Response Content: &quot;</span> + EntityUtils.toString(response.getEntity()));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 带参数 GET 请求示例</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sendGetRequestWithParams</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClients.createDefault()) &#123;</span><br><span class="line">            <span class="type">URI</span> <span class="variable">uri</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URIBuilder</span>(<span class="string">&quot;http://localhost:8080/posts&quot;</span>)</span><br><span class="line">                    .addParameter(<span class="string">&quot;userId&quot;</span>, <span class="string">&quot;1&quot;</span>)</span><br><span class="line">                    .build();</span><br><span class="line">            <span class="type">HttpGet</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpGet</span>(uri);</span><br><span class="line">            <span class="type">HttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> httpClient.execute(request);</span><br><span class="line">            System.out.println(<span class="string">&quot;GET With Params Response Status: &quot;</span> </span><br><span class="line">                    + response.getStatusLine().getStatusCode());</span><br><span class="line">            System.out.println(<span class="string">&quot;Response Content: &quot;</span> + EntityUtils.toString(response.getEntity()));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 无参数 POST 请求示例</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sendPostRequestNoParams</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClients.createDefault()) &#123;</span><br><span class="line">            <span class="type">HttpPost</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpPost</span>(<span class="string">&quot;http://localhost:8080/posts&quot;</span>);</span><br><span class="line">            <span class="type">HttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> httpClient.execute(request);</span><br><span class="line">            System.out.println(<span class="string">&quot;POST No Params Response Status: &quot;</span> </span><br><span class="line">                    + response.getStatusLine().getStatusCode());</span><br><span class="line">            System.out.println(<span class="string">&quot;Response Content: &quot;</span> + EntityUtils.toString(response.getEntity()));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 带 User 对象参数的 POST 请求示例</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sendPostRequestWithUser</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClients.createDefault()) &#123;</span><br><span class="line">            <span class="type">HttpPost</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpPost</span>(<span class="string">&quot;http://localhost:8080/posts&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 创建 User 对象</span></span><br><span class="line">            <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;Alice&quot;</span>, <span class="number">25</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 将 User 对象转换为 JSON 字符串</span></span><br><span class="line">            <span class="type">ObjectMapper</span> <span class="variable">objectMapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">            <span class="type">String</span> <span class="variable">jsonPayload</span> <span class="operator">=</span> objectMapper.writeValueAsString(user);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 设置 JSON 请求体</span></span><br><span class="line">            <span class="type">StringEntity</span> <span class="variable">entity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringEntity</span>(jsonPayload);</span><br><span class="line">            entity.setContentType(<span class="string">&quot;application/json&quot;</span>); <span class="comment">// 标记格式为application/json，http才知道它是json</span></span><br><span class="line">            request.setEntity(entity);</span><br><span class="line"></span><br><span class="line">            <span class="type">HttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> httpClient.execute(request);</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;POST With User Object Response Status: &quot;</span> </span><br><span class="line">                    + response.getStatusLine().getStatusCode());</span><br><span class="line">            System.out.println(<span class="string">&quot;Response Content: &quot;</span> + EntityUtils.toString(response.getEntity()));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义 User 类</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="RestTemplate"><a href="#RestTemplate" class="headerlink" title="RestTemplate"></a>RestTemplate</h2><h3 id="简介-1"><a href="#简介-1" class="headerlink" title="简介"></a>简介</h3><p>Spring 提供了一个 RestTemplate 模板工具类，对基于 Http 的客户端进行了封装，并且实现了对象与 JSON 的序列化与反序列化，非常方便（上面的HttpClient返回的相应是 JSON 格式的）。RestTemplate 并没有限定 Http 客户端类型，而是进行了抽象，目前常用的三种都支持：</p><ul><li>HttpClient</li><li>OKHttp</li><li>JDK原生的URLConnection（默认的）</li></ul><blockquote><p>RestTemplate是阻塞式的，性能没有响应式式的 WebClient 优秀</p></blockquote><h3 id="具体使用"><a href="#具体使用" class="headerlink" title="具体使用"></a>具体使用</h3><ol><li><strong>引入Maven依赖</strong></li></ol><div class="code-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Spring Web 依赖，包含 RestTemplate 和其他 Web 相关功能 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div><ol start="2"><li><strong>创建配置类</strong></li></ol><div class="code-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RestTemplateConfig</span> &#123;</span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">(RestTemplateBuilder builder)</span> &#123;</span><br><span class="line">    	<span class="type">HttpComponentsClientHttpRequestFactory</span> <span class="variable">requestFactory</span> <span class="operator">=</span> <span class="keyword">new</span> 			<span class="title class_">HttpComponentsClientHttpRequestFactory</span>(HttpClients.createDefault());</span><br><span class="line">    	requestFactory.setConnectTimeout(<span class="number">5000</span>);  <span class="comment">// 设置连接超时时间，单位为毫秒</span></span><br><span class="line">    	requestFactory.setReadTimeout(<span class="number">10000</span>);   <span class="comment">// 设置读取超时时间，单位为毫秒</span></span><br><span class="line"></span><br><span class="line">    	<span class="keyword">return</span> builder</span><br><span class="line">            .requestFactory(() -&gt; requestFactory)</span><br><span class="line">            .build();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ol start="3"><li><strong>具体使用</strong></li></ol><div class="code-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RestTemplateService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// GET 请求示例</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getForObjectExample</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;https://jsonplaceholder.typicode.com/posts/1&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> restTemplate.getForObject(url, String.class);</span><br><span class="line">        <span class="keyword">return</span> response; <span class="comment">// 返回 JSON 格式的响应</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// POST 请求示例</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">postForObjectExample</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;https://jsonplaceholder.typicode.com/posts&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 构建请求体</span></span><br><span class="line">        Map&lt;String, Object&gt; requestBody = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        requestBody.put(<span class="string">&quot;title&quot;</span>, <span class="string">&quot;foo&quot;</span>);</span><br><span class="line">        requestBody.put(<span class="string">&quot;body&quot;</span>, <span class="string">&quot;bar&quot;</span>);</span><br><span class="line">        requestBody.put(<span class="string">&quot;userId&quot;</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 发送 POST 请求并接收响应</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> restTemplate.postForObject(url, requestBody, String.class);</span><br><span class="line">        <span class="keyword">return</span> response;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><ol start="4"><li><strong>常用方法</strong></li></ol><table><thead><tr><th>方法名</th><th>请求类型</th><th>描述</th></tr></thead><tbody><tr><td><code>getForObject</code></td><td>GET</td><td>获取资源并将响应直接映射为 Java 对象。</td></tr><tr><td><code>getForEntity</code></td><td>GET</td><td>获取资源，返回 <code>ResponseEntity</code>，包含状态码、头信息和响应体。</td></tr><tr><td><code>postForObject</code></td><td>POST</td><td>发送请求体，并将响应映射为 Java 对象。</td></tr><tr><td><code>postForEntity</code></td><td>POST</td><td>发送请求体，返回 <code>ResponseEntity</code>。</td></tr><tr><td><code>put</code></td><td>PUT</td><td>发送 PUT 请求，无返回值。</td></tr><tr><td><code>delete</code></td><td>DELETE</td><td>发送 DELETE 请求，无返回值。</td></tr><tr><td><code>exchange</code></td><td>多种</td><td>提供更灵活的方式发送请求（支持自定义 HTTP 方法、头信息等）。</td></tr><tr><td><code>execute</code></td><td>多种</td><td>最底层的 HTTP 操作，可完全自定义请求。</td></tr></tbody></table><p><img lazyload src="/images/loading.svg" data-src="https://gitee.com/lusy37/typora/raw/master/202502132338149.png"></p><ol start="5"><li><strong>使用 <code>exchange</code> 发送自定义请求</strong></li></ol><p>如果需要添加自定义请求头或使用复杂配置，可以使用 <code>exchange</code> 方法：</p><div class="code-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.http.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RestTemplateCustomExample</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">RestTemplate</span> <span class="variable">restTemplate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;https://jsonplaceholder.typicode.com/posts&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 构建请求头</span></span><br><span class="line">        <span class="type">HttpHeaders</span> <span class="variable">headers</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpHeaders</span>();</span><br><span class="line">        headers.setContentType(MediaType.APPLICATION_JSON);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 构建请求体</span></span><br><span class="line">        Map&lt;String, Object&gt; requestBody = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        requestBody.put(<span class="string">&quot;title&quot;</span>, <span class="string">&quot;foo&quot;</span>);</span><br><span class="line">        requestBody.put(<span class="string">&quot;body&quot;</span>, <span class="string">&quot;bar&quot;</span>);</span><br><span class="line">        requestBody.put(<span class="string">&quot;userId&quot;</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 构建 HttpEntity</span></span><br><span class="line">        HttpEntity&lt;Map&lt;String, Object&gt;&gt; requestEntity = <span class="keyword">new</span> <span class="title class_">HttpEntity</span>&lt;&gt;(requestBody, headers);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 发送 POST 请求</span></span><br><span class="line">        ResponseEntity&lt;String&gt; responseEntity = restTemplate.exchange(</span><br><span class="line">                url,</span><br><span class="line">                HttpMethod.POST,</span><br><span class="line">                requestEntity,</span><br><span class="line">                String.class</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 打印响应</span></span><br><span class="line">        System.out.println(<span class="string">&quot;Response Status: &quot;</span> + responseEntity.getStatusCode());</span><br><span class="line">        System.out.println(<span class="string">&quot;Response Body: &quot;</span> + responseEntity.getBody());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="HttpClient及其连接池使用"><a href="#HttpClient及其连接池使用" class="headerlink" title="HttpClient及其连接池使用"></a>HttpClient及其连接池使用</h2><h3 id="1-功能模块"><a href="#1-功能模块" class="headerlink" title="1. 功能模块"></a>1. 功能模块</h3><ol><li><strong>HttpClient 接口和实现</strong><ul><li><code>HttpClient</code>：这是 Apache HttpClient 的核心接口，定义了执行 HTTP 请求的方法</li><li><code>CloseableHttpClient</code>：HttpClient 的主要实现类，提供了对 HTTP 请求的同步执行，并实现了 <code>Closeable</code> 接口，以便在使用完毕后释放资源。</li></ul></li><li><strong>请求与相应</strong><ul><li><strong>请求类</strong>：包括 <code>HttpGet</code>、<code>HttpPost</code>、<code>HttpPut</code>、<code>HttpDelete</code> 等，分别用于不同类型的 HTTP 请求。</li><li><strong>相应类</strong>：<code>HttpResponse</code> 接口用于表示 HTTP 响应，提供方法获取状态码、响应头和响应体。</li><li><strong><code>HttpEntity</code></strong>：表示请求或响应的内容主体，可以是流、字符串、字节数组等。【具体看 entity 接口的实现类】</li></ul></li><li><strong>连接管理</strong><ul><li><code>HttpClientConnectionManager</code>：接口用于管理 HTTP 连接的生命周期。</li><li><code>PoolingHttpClientConnectionManager</code>：常用的实现类，支持连接池管理，允许连接复用以提高性能，可以配置最大连接数和每个路由的最大连接数。</li></ul></li><li><strong>请求配置</strong><ul><li><code>RequestConfig</code>：用于配置请求参数，如连接超时、套接字超时、代理设置、重定向策略等。</li><li><code>SocketConfig</code>：用于配置套接字参数，如 TCP_NODELAY 、SO_TIMEOUT 等。</li></ul></li><li><strong>身份认证</strong><ul><li><code>CredentialsProvider</code>：用于提供认证信息，支持多种认证机制（Basic、Digest、NTLM、Kerberos）。</li><li><code>AuthCache</code>：缓存认证信息，减少重复认证的开销。</li></ul></li><li><strong>重试和重定向</strong><ul><li><code>HttpRequestRetryHandler</code>：定义重试策略，处理请求失败后的重试逻辑。</li><li><code>RedirectStrategy</code>：管理请求重定向，处理 3xx 响应状态码。</li></ul></li><li><strong>异步处理</strong><ul><li><code>HttpAsyncClient</code>：提供异步 HTTP 请求的支持，通过回调接口处理异步请求的结果。</li></ul></li><li><strong>拦截器</strong><ul><li><code>HttpRequestInterceptor</code> 和 <code>HttpResponseInterceptor</code>：允许在请求发送前和响应处理前后执行自定义逻辑，提供请求和响应的拦截和修改功能。</li></ul></li><li><strong>Cookie 管理</strong><ul><li><code>CookieStore</code>：用于存储和管理 HTTP Cookie。</li><li><code>CookieSpec</code>：定义 Cookie 的处理规则。</li></ul></li></ol><h3 id="2-工作原理"><a href="#2-工作原理" class="headerlink" title="2. 工作原理"></a>2. 工作原理</h3><ol><li><p><strong>连接管理器</strong></p><ul><li><code>PoolingHTTPClientConnectionManager</code>：用于管理HTTP连接池。通过设置最大连接数和每个路由的最大连接数，确保连接的高效复用。</li></ul></li><li><p><strong>请求配置</strong></p><ul><li><p>使用 <code>RequestConfig</code> 配置请求的超时时间、包括套接字超时、连接超时和请求超时。这样可以确保在网络条件不佳时，程序不会无限制地等待。</p><blockquote><ul><li><p>套接字超时：数据传输的最大等待时间</p></li><li><p>连接超时：连接建立的最大等待时间</p></li><li><p>请求超时：整体请求的最大等待时间</p></li></ul></blockquote></li></ul></li><li><p><strong>HttpClient 实例化</strong></p><ul><li>使用 <code>HttpClients.custom()</code> 方法创建 <code>CloseableHttpClient</code> 实例，并应用连接管理器和请求配置。</li><li><code>CloseableHttpClient</code> 是 <code>HttpClient</code> 的主要实现类，支持资源管理。</li></ul></li><li><p><strong>创建请求</strong></p><ul><li>创建一个 <code>HttpGet</code> 实例，指定请求的 URL 。在实际应用中，可以根据需要使用 <code>HttpPost</code>、<code>HttpPut</code> 等请求类。</li></ul></li><li><p><strong>执行请求</strong></p><ul><li>使用 <code>httpClient.execute(httpGet)</code> 方法执行请求，并获取 <code>CloseableHttpResponse</code> 对象。</li><li>连接管理器负责分配和管理连接的生命周期。</li></ul></li><li><p><strong>处理响应</strong></p><ul><li>从 <code>HttpResponse</code> 对象中获取状态行，检查请求是否成功。</li><li>使用 <code>EntityUtils.toString(entity)</code> 将响应实体转换为字符串，方便读取和处理响应数据。</li></ul></li><li><p><strong>资源释放</strong></p><ul><li>使用 <code>try-with-resources</code> 语法，确保 <code>CloseableHttpClient</code> 和 <code>CloseableHttpResponse</code> 在使用完毕后自动关闭，释放系统资源。</li></ul></li></ol><p>为了更好地理解 Apache HttpClient 的工作原理，下面将通过一个简单的示例代码来演示其核心组件的使用和工作流程。这段代码将展示如何创建一个 HTTP 客户端，发送 GET 请求，并处理响应。</p><ul><li><strong>引入Maven依赖</strong></li></ul><div class="code-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.5.14<span class="tag">&lt;/<span class="name">version</span>&gt;</span> <span class="comment">&lt;!-- 请使用最新的稳定版本 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div><ul><li><strong>示例代码</strong></li></ul><div class="code-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpClientExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建一个连接管理器</span></span><br><span class="line">        <span class="type">PoolingHttpClientConnectionManager</span> <span class="variable">connManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PoolingHttpClientConnectionManager</span>();</span><br><span class="line">        connManager.setMaxTotal(<span class="number">100</span>); <span class="comment">// 设置最大连接数</span></span><br><span class="line">        connManager.setDefaultMaxPerRoute(<span class="number">20</span>); <span class="comment">// 每个路由的默认最大连接数</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建一个请求配置</span></span><br><span class="line">        <span class="type">RequestConfig</span> <span class="variable">requestConfig</span> <span class="operator">=</span> RequestConfig.custom()</span><br><span class="line">                .setSocketTimeout(<span class="number">5000</span>) <span class="comment">// 套接字超时</span></span><br><span class="line">                .setConnectTimeout(<span class="number">5000</span>) <span class="comment">// 连接超时</span></span><br><span class="line">                .setConnectionRequestTimeout(<span class="number">5000</span>) <span class="comment">// 请求超时</span></span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建一个可关闭的 HttpClient 实例，并应用连接管理器和请求配置</span></span><br><span class="line">        <span class="keyword">try</span> (<span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClients.custom()</span><br><span class="line">                .setConnectionManager(connManager)</span><br><span class="line">                .setDefaultRequestConfig(requestConfig)</span><br><span class="line">                .build()) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 创建一个 GET 请求</span></span><br><span class="line">            <span class="type">HttpGet</span> <span class="variable">httpGet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpGet</span>(<span class="string">&quot;https://www.example.com&quot;</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 执行请求</span></span><br><span class="line">            <span class="keyword">try</span> (<span class="type">CloseableHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> httpClient.execute(httpGet)) &#123;</span><br><span class="line">                <span class="comment">// 获取响应状态</span></span><br><span class="line">                System.out.println(<span class="string">&quot;Response Status: &quot;</span> + response.getStatusLine());</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 获取响应实体</span></span><br><span class="line">                <span class="type">HttpEntity</span> <span class="variable">entity</span> <span class="operator">=</span> response.getEntity();</span><br><span class="line">                <span class="keyword">if</span> (entity != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// 将响应实体转换为字符串</span></span><br><span class="line">                    <span class="type">String</span> <span class="variable">responseBody</span> <span class="operator">=</span> EntityUtils.toString(entity);</span><br><span class="line">                    System.out.println(<span class="string">&quot;Response Body: &quot;</span> + responseBody);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h3 id="3-异步请求"><a href="#3-异步请求" class="headerlink" title="3. 异步请求"></a>3. 异步请求</h3><p>Apache HttpClient 的异步请求功能是通过 <code>HttpAsyncClient</code> 实现的，它使用 Java NIO 的非阻塞 I&#x2F;O 来处理 HTTP 请求。它可以在不阻塞线程的情况下发送和接收请求，满足高并发的需求。</p><h4 id="3-1-工作原理"><a href="#3-1-工作原理" class="headerlink" title="3.1 工作原理"></a>3.1 工作原理</h4><ol><li><strong>非阻塞 I&#x2F;O</strong><ul><li>Apache HttpAsyncClient 使用 Java NIO 来实现非阻塞 I&#x2F;O。请求和响应的处理可以在同一线程中进行，不需要为每一个请求单独分配一个独立的线程。</li></ul></li><li><strong>事件驱动</strong><ul><li>通过事件驱动机制处理 I&#x2F;O 操作的完成。请求的完成、失败或取消会触发响应的回调方法。</li></ul></li><li><strong>回调机制</strong><ul><li>使用 <code>FutureCallback</code> 接口处理请求的不同结果，包括成功、失败和取消。</li></ul></li></ol><h4 id="3-2-调优配置"><a href="#3-2-调优配置" class="headerlink" title="3.2 调优配置"></a>3.2 调优配置</h4><p>为了在高并发环境下实现最佳性能，配置连接管理和线程池是关键。</p><ol><li><strong>连接管理器</strong><ul><li>使用 <code>PollingHttpClientConnectionManager</code> 管理连接池，可以设置最大连接数和每个路由的最大连接数。</li></ul></li><li><strong>IO Reactor 配置</strong><ul><li>配置 IO 线程的数量，通常设置为可用处理器的数量，以充分利用多核 CPU 的性能。</li></ul></li><li><strong>线程池</strong><ul><li>自定义线程池可以通过 <code>ExecutorService</code> 和 <code>ThreadFactory</code> 来控制异步请求的执行线程数量。</li></ul></li></ol><h5 id="连接池"><a href="#连接池" class="headerlink" title="连接池"></a>连接池</h5><p><code>PoolingHttpClientConnectionManager</code> 管理连接池，支持连接复用和高效的多线程环境，具体见下文。</p><h5 id="IO-Reactor-配置"><a href="#IO-Reactor-配置" class="headerlink" title="IO Reactor 配置"></a>IO Reactor 配置</h5><p><strong>IO Reactor</strong> 是 Apache HttpClient 异步客户端的核心组件之一，主要用于处理网络 I&#x2F;O 操作。它的主要职责包括：</p><ul><li><strong>事件监听</strong><ul><li>IO Reactor 监听网络事件（如连接建立、数据到达等），并触发相应的处理操作。</li><li>使用 Java NIO 的 <code>Selector</code> 机制来实现高效的事件驱动。</li></ul></li><li><strong>线程管理</strong><ul><li>IO Reactor 通常包含一组 IO 线程，这些线程专门用于处理网络 I&#x2F;O 操作。</li><li>这些线程的数量通常设置为可用处理器的数量，以充分利用多核 CPU 的性能</li></ul></li></ul><h5 id="自定义线程池"><a href="#自定义线程池" class="headerlink" title="自定义线程池"></a>自定义线程池</h5><p><strong>线程池</strong>主要用于管理异步请求的执行线程，它负责：</p><ul><li><strong>任务调度</strong><ul><li>线程池负责调度和执行异步请求的任务。</li><li>当一个异步请求被提交到 HttpClient 时，线程池会选择一个线程来执行该请求。</li></ul></li><li><strong>资源管理</strong><ul><li>线程池可以限制执行请求的线程数量，防止过多的线程导致系统资源耗尽。</li><li>通过设置线程的大小，可以人为控制并发请求的数量。</li></ul></li></ul><h4 id="示例代码"><a href="#示例代码" class="headerlink" title="示例代码"></a>示例代码</h4><ul><li><strong>引入Maven依赖</strong></li></ul><div class="code-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpasyncclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span> <span class="comment">&lt;!-- 请使用最新的稳定版本 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpcore-nio<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.4.15<span class="tag">&lt;/<span class="name">version</span>&gt;</span> <span class="comment">&lt;!-- 请使用最新的稳定版本 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div><ul><li><strong>示例代码</strong></li></ul><div class="code-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AsyncHttpClientExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 配置 IO Reactor</span></span><br><span class="line">        <span class="type">IOReactorConfig</span> <span class="variable">ioReactorConfig</span> <span class="operator">=</span> IOReactorConfig.custom()</span><br><span class="line">                .setIoThreadCount(Runtime.getRuntime().availableProcessors()) <span class="comment">// 设置IO线程数</span></span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建连接管理器</span></span><br><span class="line">        <span class="type">PoolingNHttpClientConnectionManager</span> <span class="variable">connectionManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PoolingNHttpClientConnectionManager</span>(</span><br><span class="line">            			<span class="keyword">new</span> <span class="title class_">DefaultConnectingIOReactor</span>(ioReactorConfig));</span><br><span class="line">        </span><br><span class="line">        connectionManager.setMaxTotal(<span class="number">100</span>); <span class="comment">// 设置最大连接数</span></span><br><span class="line">        connectionManager.setDefaultMaxPerRoute(<span class="number">20</span>); <span class="comment">// 每个路由的默认最大连接数</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 自定义线程池</span></span><br><span class="line">        <span class="type">ThreadFactory</span> <span class="variable">threadFactory</span> <span class="operator">=</span> Executors.defaultThreadFactory();</span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">executorService</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">10</span>, threadFactory);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建异步 HttpClient</span></span><br><span class="line">        <span class="keyword">try</span> (<span class="type">CloseableHttpAsyncClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpAsyncClients.custom()</span><br><span class="line">                .setConnectionManager(connectionManager)</span><br><span class="line">                .setThreadFactory(threadFactory)</span><br><span class="line">                .setExecutorService(executorService)</span><br><span class="line">                .build()) &#123;</span><br><span class="line">            httpClient.start();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 使用 CountDownLatch 等待请求完成</span></span><br><span class="line">            <span class="type">CountDownLatch</span> <span class="variable">latch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 创建 GET 请求</span></span><br><span class="line">            <span class="type">HttpGet</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpGet</span>(<span class="string">&quot;https://www.example.com&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 执行请求并处理回调</span></span><br><span class="line">            httpClient.execute(request, <span class="keyword">new</span> <span class="title class_">FutureCallback</span>&lt;HttpResponse&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">completed</span><span class="params">(HttpResponse response)</span> &#123;</span><br><span class="line">                    <span class="comment">// 请求成功时调用</span></span><br><span class="line">                    System.out.println(<span class="string">&quot;Response: &quot;</span> + response.getStatusLine());</span><br><span class="line">                    latch.countDown(); <span class="comment">// 减少计数器</span></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">failed</span><span class="params">(Exception ex)</span> &#123;</span><br><span class="line">                    <span class="comment">// 请求失败时调用</span></span><br><span class="line">                    System.out.println(<span class="string">&quot;Request failed: &quot;</span> + ex.getMessage());</span><br><span class="line">                    latch.countDown(); <span class="comment">// 减少计数器</span></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cancelled</span><span class="params">()</span> &#123;</span><br><span class="line">                    <span class="comment">// 请求取消时调用</span></span><br><span class="line">                    System.out.println(<span class="string">&quot;Request cancelled&quot;</span>);</span><br><span class="line">                    latch.countDown(); <span class="comment">// 减少计数器</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 等待请求完成</span></span><br><span class="line">            latch.await();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h3 id="4-连接池"><a href="#4-连接池" class="headerlink" title="4. 连接池"></a>4. 连接池</h3><h4 id="4-1-基本概念"><a href="#4-1-基本概念" class="headerlink" title="4.1 基本概念"></a>4.1 基本概念</h4><p>Apache HttpClient 的连接池通过 <code>PoolingHttpClientConnectionManager</code> 提供高效的连接管理功能。它允许客户端在执行 HTTP 请求时重用连接，以提高性能和资源利用率。</p><h4 id="4-2-基本原理"><a href="#4-2-基本原理" class="headerlink" title="4.2 基本原理"></a>4.2 基本原理</h4><ol><li><strong>连接复用</strong><ul><li>连接池通过维护一个连接集合，允许多个请求重用同一连接，避免每次请求都需要建立和关闭连接的开销。</li></ul></li><li><strong>连接分配</strong><ul><li>当一个请求需要发送是，连接池首先检查是否有空闲连接可用。如果有，则直接复用；如果没有，则根据配置创建新的连接。</li></ul></li><li><strong>连接释放</strong><ul><li>请求完成后，连接并不立即关闭，而是被释放回池中，以便后续请求使用。</li></ul></li><li><strong>连接过期和验证</strong><ul><li>为了避免使用失效的连接，连接池会在连接空闲时间过长时对其进行验证，并根据配置自动清理过期或不再有效的连接。</li></ul></li></ol><h4 id="4-3-关键组件和配置"><a href="#4-3-关键组件和配置" class="headerlink" title="4.3 关键组件和配置"></a>4.3 关键组件和配置</h4><ol><li><p><code>PoolingHttpClientConnectionManager</code></p><ul><li>核心连接管理器，负责维护连接池。</li><li>提供方法设置总连接数（<code>setMaxTotal</code>）和每个路由的最大连接数（<code>setDefaultMaxPerRoute</code>）。</li></ul></li><li><p><strong>路由（Route）</strong></p><ul><li>由目标主机、端口和协议组成，用于识别不同的连接路径。</li><li>可以为特定路由设置不同的最大连接数。</li></ul></li><li><p><strong>连接保持策略（Keep-Alive Strategy）</strong></p><ul><li>通过 <code>ConnectionKeepAliveStrategy</code> 确定连接的保持时间。</li><li>可以自定义策略，以根据响应头信息动态调整连接的保持时间。</li></ul></li><li><p><strong>连接验证和清理</strong></p><ul><li>使用 <code>IdleConnectionEvictor</code> 定期检查和清理空闲连接，防止资源浪费。</li><li><code>validateAfterInactivity</code> 设置连接空闲时间超过某个阈值后，在使用前需要进行验证。</li></ul></li></ol><h4 id="4-4-工作机制"><a href="#4-4-工作机制" class="headerlink" title="4.4 工作机制"></a>4.4 工作机制</h4><ol><li><strong>请求到达</strong><ul><li>客户端请求到达，连接管理器检查是否有可用的空闲连接。</li><li>如果有，则复用空闲连接；否则，根据配置创建新连接。</li></ul></li><li><strong>连接使用</strong><ul><li>请求使用连接和服务器进行通信。</li><li>完成后，连接被标记为可用，并返回连接池。</li></ul></li><li><strong>连接验证</strong><ul><li>在空闲连接重新使用前，连接管理器可能会对其进行验证，以确保连接仍然有效。</li></ul></li><li><strong>连接清理</strong><ul><li>定期清理空闲和过期连接，以释放系统资源。</li></ul></li></ol><h4 id="4-5-示例代码"><a href="#4-5-示例代码" class="headerlink" title="4.5 示例代码"></a>4.5 示例代码</h4><p>以下是一个示例代码，展示如何配置和使用 Apache HttpClient 的连接池：</p><div class="code-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpClientConnectionPoolExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建连接池管理器</span></span><br><span class="line">        <span class="type">PoolingHttpClientConnectionManager</span> <span class="variable">connectionManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PoolingHttpClientConnectionManager</span>();</span><br><span class="line">        connectionManager.setMaxTotal(<span class="number">50</span>); <span class="comment">// 设置连接池的总最大连接数</span></span><br><span class="line">        connectionManager.setDefaultMaxPerRoute(<span class="number">5</span>); <span class="comment">// 设置每个路由的默认最大连接数</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 为特定的主机设置最大连接数</span></span><br><span class="line">        <span class="type">HttpHost</span> <span class="variable">targetHost</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpHost</span>(<span class="string">&quot;www.example.com&quot;</span>, <span class="number">80</span>);</span><br><span class="line">        connectionManager.setMaxPerRoute(<span class="keyword">new</span> <span class="title class_">HttpRoute</span>(targetHost), <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置自定义的 ConnectionKeepAliveStrategy</span></span><br><span class="line">        <span class="type">ConnectionKeepAliveStrategy</span> <span class="variable">keepAliveStrategy</span> <span class="operator">=</span> (HttpResponse response, HttpContext context) -&gt; &#123;</span><br><span class="line">            <span class="comment">// 从响应头中获取 Keep-Alive 信息</span></span><br><span class="line">            <span class="type">long</span> <span class="variable">keepAliveDuration</span> <span class="operator">=</span> <span class="number">5</span> * <span class="number">1000</span>; <span class="comment">// 默认 5 秒</span></span><br><span class="line">            <span class="keyword">return</span> keepAliveDuration;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置连接超时时间和读取超时时间</span></span><br><span class="line">        <span class="type">RequestConfig</span> <span class="variable">requestConfig</span> <span class="operator">=</span> RequestConfig.custom()</span><br><span class="line">                .setConnectTimeout(<span class="number">5000</span>)    <span class="comment">// 连接超时时间：5秒</span></span><br><span class="line">                .setSocketTimeout(<span class="number">5000</span>)     <span class="comment">// 读取超时时间：5秒</span></span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建 HttpClient 并配置连接管理器、请求配置和保持策略</span></span><br><span class="line">        <span class="keyword">try</span> (<span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClients.custom()</span><br><span class="line">                .setConnectionManager(connectionManager)</span><br><span class="line">                .setDefaultRequestConfig(requestConfig)</span><br><span class="line">                .setKeepAliveStrategy(keepAliveStrategy)</span><br><span class="line">                .build()) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 创建一个 GET 请求</span></span><br><span class="line">            <span class="type">HttpGet</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpGet</span>(<span class="string">&quot;http://www.example.com&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 执行请求</span></span><br><span class="line">            <span class="keyword">try</span> (<span class="type">CloseableHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> httpClient.execute(request)) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Response Status: &quot;</span> + response.getStatusLine());</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 获取响应实体</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">responseBody</span> <span class="operator">=</span> EntityUtils.toString(response.getEntity());</span><br><span class="line">                System.out.println(<span class="string">&quot;Response Body: &quot;</span> + responseBody);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h4 id="4-6-作用范围"><a href="#4-6-作用范围" class="headerlink" title="4.6 作用范围"></a>4.6 作用范围</h4><p>和 <code>OkHttp</code> 不同，<code>Apache HttpClient</code> 的连接池不仅可以控制总最大连接数（<code>setMaxTotal</code>），还可以控制每个路由（每个目标主机）的最大连接数（<code>setDefaultMaxPerRoute</code>），甚至还可以为特定的主机或路由指定不同的最大连接数（<code>setMaxPerRoute</code>）。</p><p>虽然 <code>OkHttp</code> 控制不了单机的最大连接数，但是有<strong>调度器</strong>（<code>Dispatcher</code>）替代，可以实现单机最大并发请求数控制。而<code>Apache HttpClient</code>中则没有类似<strong>调度器</strong>（<code>Dispatcher</code>）的组件。所以二者各有互补。</p><h3 id="5-和-OkHttp-对比"><a href="#5-和-OkHttp-对比" class="headerlink" title="5. 和 OkHttp 对比"></a>5. 和 OkHttp 对比</h3><p>从性能角度来看，OkHttp 和 Apache HttpClient 各有其优劣，具体取决于使用场景和配置。以下是对两者在性能方面的详细对比：</p><h4 id="5-1-连接管理和复用"><a href="#5-1-连接管理和复用" class="headerlink" title="5.1. 连接管理和复用"></a>5.1. 连接管理和复用</h4><ul><li><p><strong>OkHttp</strong></p><ul><li><p><strong>连接池</strong>：OkHttp 内置了一个高效的连接池，自动管理连接的生命周期，默认情况下支持 HTTP&#x2F;2 的多路复用，能够显著减少网络延迟。</p></li><li><p><strong>连接复用</strong>：通过复用连接来减少连接建立的开销，尤其是在高并发场景下，表现出色。</p></li><li><p><strong>并发性能</strong>：得益于 HTTP&#x2F;2 支持和连接池管理，OkHttp 在处理并发请求时具有较高的吞吐量和低延迟。</p></li></ul></li><li><p><strong>Apache HttpClient</strong></p><ul><li><p><strong>连接池管理</strong>：使用 <code>PoolingHttpClientConnectionManager</code> 进行连接池管理，允许更细粒度的连接配置。</p></li><li><p><strong>连接复用</strong>：也支持连接复用，但需要手动配置和管理连接池，使用不当可能导致性能瓶颈。</p></li><li><p><strong>路由控制</strong>：提供对连接路由的详细控制，适合复杂的网络拓扑，但可能增加配置复杂性。</p></li></ul></li></ul><h4 id="5-2-协议支持"><a href="#5-2-协议支持" class="headerlink" title="5.2. 协议支持"></a>5.2. 协议支持</h4><ul><li><p><strong>OkHttp</strong></p><ul><li><p><strong>HTTP&#x2F;2 支持</strong>：OkHttp 原生支持 HTTP&#x2F;2，能够有效提高并发请求的性能，特别是在长连接和多请求场景下。</p></li><li><p><strong>WebSocket 支持</strong>：内置支持 WebSocket，可以用于实时通信场景。</p></li></ul></li><li><p><strong>Apache HttpClient</strong></p><ul><li><p><strong>HTTP&#x2F;1.1 支持</strong>：主要支持 HTTP&#x2F;1.1，缺乏对 HTTP&#x2F;2 的原生支持，可能在现代网络应用中表现稍逊。</p></li><li><p><strong>扩展性</strong>：虽然可以通过第三方库实现 HTTP&#x2F;2 支持，但增加了复杂性和潜在的性能开销。</p></li></ul></li></ul><h4 id="5-3-异步处理"><a href="#5-3-异步处理" class="headerlink" title="5.3. 异步处理"></a>5.3. 异步处理</h4><ul><li><p><strong>OkHttp</strong></p><ul><li><p><strong>异步请求</strong>：OkHttp 提供了简单易用的异步 API，通过回调机制处理请求和响应，减少了线程管理的开销。</p></li><li><p><strong>线程池管理</strong>：内置的线程池管理简化了异步请求的调度，提高了异步处理的效率。</p></li></ul></li><li><p><strong>Apache HttpClient</strong></p><ul><li><p><strong>异步请求</strong>：通过 <code>HttpAsyncClient</code> 提供异步请求支持，但配置和使用相对复杂，需要手动管理线程池。</p></li><li><p><strong>复杂场景</strong>：在复杂的异步场景中可能需要更多的样板代码和配置，增加了开发和维护成本。</p></li></ul></li></ul><h4 id="5-4-缓存机制"><a href="#5-4-缓存机制" class="headerlink" title="5.4. 缓存机制"></a>5.4. 缓存机制</h4><ul><li><p><strong>OkHttp</strong></p><ul><li><p><strong>内置缓存</strong>：OkHttp 提供了内置的缓存机制，可以自动处理 HTTP 缓存头，减少网络请求次数，提升性能。</p></li><li><p><strong>灵活的缓存策略</strong>：支持自定义缓存策略，通过拦截器机制实现缓存控制。</p></li></ul></li><li><p><strong>Apache HttpClient</strong></p><ul><li><strong>缓存支持</strong>：需要手动实现缓存机制，Apache HttpClient 不提供开箱即用的缓存支持，增加了实现复杂性。</li></ul></li></ul><h4 id="5-5-资源消耗"><a href="#5-5-资源消耗" class="headerlink" title="5.5. 资源消耗"></a>5.5. 资源消耗</h4><ul><li><p><strong>OkHttp</strong></p><ul><li><p><strong>轻量级</strong>：相对较小的内存和 CPU 占用，适合在资源受限的环境（如 Android）中使用。</p></li><li><p><strong>优化的资源使用</strong>：得益于高效的连接管理和异步处理机制，OkHttp 在资源使用上表现优秀。</p></li></ul></li><li><p><strong>Apache HttpClient</strong></p><ul><li><p><strong>资源消耗</strong>：由于其功能丰富和高度可配置，可能在复杂配置下增加内存和 CPU 占用。</p></li><li><p><strong>线程安全</strong>：设计为线程安全，但需要合理配置以避免资源浪费。</p></li></ul></li></ul><h4 id="5-6-总结"><a href="#5-6-总结" class="headerlink" title="5.6. 总结"></a>5.6. 总结</h4><ul><li><strong>OkHttp</strong>：<ul><li>在现代应用中，尤其是需要 HTTP&#x2F;2 和 WebSocket 支持的场景下，OkHttp 在性能上表现优异。</li><li>适合需要高并发处理和低延迟的应用场景，如移动应用和微服务架构。</li><li>内置的缓存和异步支持简化了开发，减少了资源消耗。</li></ul></li><li><strong>Apache HttpClient</strong>：<ul><li>在需要复杂配置和扩展的场景下，Apache HttpClient 提供了灵活性，但可能在性能上稍逊。</li><li>适合在服务器端处理复杂的 HTTP 请求，尤其是需要复杂身份验证和路由控制的场景。</li><li>需要手动优化连接管理和异步处理以提升性能。</li></ul></li></ul><h2 id="HttpClient工具类模板"><a href="#HttpClient工具类模板" class="headerlink" title="HttpClient工具类模板"></a>HttpClient工具类模板</h2><h3 id="HttpClientUtil-类概述"><a href="#HttpClientUtil-类概述" class="headerlink" title="HttpClientUtil 类概述"></a>HttpClientUtil 类概述</h3><p>该类是一个 HTTP 请求工具类，包含了发送 <code>GET</code> 和 <code>POST</code> 请求的功能，支持普通的表单数据和 JSON 数据的发送。它使用 <code>Apache HttpClient</code> 来执行 HTTP 请求，并通过配置连接超时、读取超时等参数来增强请求的稳定性。</p><hr><h3 id="代码注释与功能说明"><a href="#代码注释与功能说明" class="headerlink" title="代码注释与功能说明"></a>代码注释与功能说明</h3><div class="code-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * HttpClient工具类，提供了发送GET、POST请求的方法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpClientUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 超时时间（5秒）</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">TIMEOUT_MSEC</span> <span class="operator">=</span> <span class="number">5</span> * <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发送GET方式请求</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> url     请求的URL</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> paramMap 请求的参数，键值对形式</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回响应结果字符串</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">doGet</span><span class="params">(String url, Map&lt;String, String&gt; paramMap)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建Httpclient对象</span></span><br><span class="line">        <span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClients.createDefault();</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="type">CloseableHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 构造URL并附加参数</span></span><br><span class="line">            <span class="type">URIBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URIBuilder</span>(url);</span><br><span class="line">            <span class="keyword">if</span> (paramMap != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span> (String key : paramMap.keySet()) &#123;</span><br><span class="line">                    builder.addParameter(key, paramMap.get(key));  <span class="comment">// 添加参数</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">URI</span> <span class="variable">uri</span> <span class="operator">=</span> builder.build();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 创建GET请求</span></span><br><span class="line">            <span class="type">HttpGet</span> <span class="variable">httpGet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpGet</span>(uri);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 发送请求</span></span><br><span class="line">            response = httpClient.execute(httpGet);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 判断响应状态</span></span><br><span class="line">            <span class="keyword">if</span> (response.getStatusLine().getStatusCode() == <span class="number">200</span>) &#123;</span><br><span class="line">                result = EntityUtils.toString(response.getEntity(), <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// 确保释放资源</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                response.close();</span><br><span class="line">                httpClient.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发送POST方式请求（表单数据）</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> url     请求的URL</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> paramMap 请求的参数，键值对形式</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回响应结果字符串</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">doPost</span><span class="params">(String url, Map&lt;String, String&gt; paramMap)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 创建Httpclient对象</span></span><br><span class="line">        <span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClients.createDefault();</span><br><span class="line">        <span class="type">CloseableHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">resultString</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 创建Http Post请求</span></span><br><span class="line">            <span class="type">HttpPost</span> <span class="variable">httpPost</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpPost</span>(url);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 创建参数列表</span></span><br><span class="line">            <span class="keyword">if</span> (paramMap != <span class="literal">null</span>) &#123;</span><br><span class="line">                List&lt;NameValuePair&gt; paramList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">                <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; param : paramMap.entrySet()) &#123;</span><br><span class="line">                    paramList.add(<span class="keyword">new</span> <span class="title class_">BasicNameValuePair</span>(param.getKey(), param.getValue()));</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 将参数封装为表单数据</span></span><br><span class="line">                <span class="type">UrlEncodedFormEntity</span> <span class="variable">entity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UrlEncodedFormEntity</span>(paramList);</span><br><span class="line">                httpPost.setEntity(entity);  <span class="comment">// 设置表单数据</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            httpPost.setConfig(builderRequestConfig()); <span class="comment">// 设置请求配置</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 执行HTTP请求</span></span><br><span class="line">            response = httpClient.execute(httpPost);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 获取响应内容</span></span><br><span class="line">            resultString = EntityUtils.toString(response.getEntity(), <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// 关闭响应流</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                response.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> resultString;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发送POST方式请求（JSON数据）</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> url     请求的URL</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> paramMap 请求的参数，键值对形式</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回响应结果字符串</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">doPost4Json</span><span class="params">(String url, Map&lt;String, String&gt; paramMap)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 创建Httpclient对象</span></span><br><span class="line">        <span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClients.createDefault();</span><br><span class="line">        <span class="type">CloseableHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">resultString</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 创建Http Post请求</span></span><br><span class="line">            <span class="type">HttpPost</span> <span class="variable">httpPost</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpPost</span>(url);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (paramMap != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// 构造JSON格式数据</span></span><br><span class="line">                <span class="type">JSONObject</span> <span class="variable">jsonObject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">                <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; param : paramMap.entrySet()) &#123;</span><br><span class="line">                    jsonObject.put(param.getKey(), param.getValue());</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="type">StringEntity</span> <span class="variable">entity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringEntity</span>(jsonObject.toString(), <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">                <span class="comment">// 设置请求内容</span></span><br><span class="line">                entity.setContentEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">                entity.setContentType(<span class="string">&quot;application/json&quot;</span>);</span><br><span class="line">                httpPost.setEntity(entity);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            httpPost.setConfig(builderRequestConfig()); <span class="comment">// 设置请求配置</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 执行HTTP请求</span></span><br><span class="line">            response = httpClient.execute(httpPost);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 获取响应内容</span></span><br><span class="line">            resultString = EntityUtils.toString(response.getEntity(), <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// 关闭响应流</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                response.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> resultString;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 构建请求配置，设置连接超时和读取超时</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回配置对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> RequestConfig <span class="title function_">builderRequestConfig</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> RequestConfig.custom()</span><br><span class="line">                .setConnectTimeout(TIMEOUT_MSEC)  <span class="comment">// 设置连接超时</span></span><br><span class="line">                .setConnectionRequestTimeout(TIMEOUT_MSEC)  <span class="comment">// 设置获取连接超时</span></span><br><span class="line">                .setSocketTimeout(TIMEOUT_MSEC)  <span class="comment">// 设置读取数据超时</span></span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><hr><h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><ol><li><strong>发送 GET 请求</strong></li></ol><div class="code-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义请求 URL 和参数</span></span><br><span class="line"><span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;https://www.example.com/api&quot;</span>;</span><br><span class="line">Map&lt;String, String&gt; params = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">params.put(<span class="string">&quot;param1&quot;</span>, <span class="string">&quot;value1&quot;</span>);</span><br><span class="line">params.put(<span class="string">&quot;param2&quot;</span>, <span class="string">&quot;value2&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用 doGet 方法发送请求</span></span><br><span class="line"><span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> HttpClientUtil.doGet(url, params);</span><br><span class="line">System.out.println(response);</span><br></pre></td></tr></table></figure></div><ol start="2"><li><strong>发送 POST 请求（表单数据）</strong></li></ol><div class="code-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义请求 URL 和参数</span></span><br><span class="line"><span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;https://www.example.com/api&quot;</span>;</span><br><span class="line">Map&lt;String, String&gt; params = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">params.put(<span class="string">&quot;param1&quot;</span>, <span class="string">&quot;value1&quot;</span>);</span><br><span class="line">params.put(<span class="string">&quot;param2&quot;</span>, <span class="string">&quot;value2&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用 doPost 方法发送 POST 请求</span></span><br><span class="line"><span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> HttpClientUtil.doPost(url, params);</span><br><span class="line">System.out.println(response);</span><br></pre></td></tr></table></figure></div><ol start="3"><li><strong>发送 POST 请求（JSON 数据）</strong></li></ol><div class="code-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义请求 URL 和参数</span></span><br><span class="line"><span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;https://www.example.com/api&quot;</span>;</span><br><span class="line">Map&lt;String, String&gt; params = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">params.put(<span class="string">&quot;param1&quot;</span>, <span class="string">&quot;value1&quot;</span>);</span><br><span class="line">params.put(<span class="string">&quot;param2&quot;</span>, <span class="string">&quot;value2&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用 doPost4Json 方法发送 JSON 格式的 POST 请求</span></span><br><span class="line"><span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> HttpClientUtil.doPost4Json(url, params);</span><br><span class="line">System.out.println(response);</span><br></pre></td></tr></table></figure></div><hr><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul><li><code>doGet</code> 方法用于发送 GET 请求，支持 URL 参数传递。</li><li><code>doPost</code> 方法用于发送 POST 请求，支持表单数据。</li><li><code>doPost4Json</code> 方法用于发送 POST 请求，支持 JSON 数据格式。</li></ul><p>这些方法统一返回请求的响应内容（字符串形式）。使用时，只需要调用相应的方法并传入 URL 和参数即可。</p></div><div class="post-copyright-info w-full my-8 px-2 sm:px-6 md:px-8"><div class="article-copyright-info-container"><ul><li><strong>Title:</strong> HttpClient</li><li><strong>Author:</strong> Lu</li><li><strong>Created at :</strong> 2024-07-18 16:42:10</li><li><strong>Updated at :</strong> 2024-07-18 18:23:54</li><li><strong>Link:</strong> https://lusy.ink/2024/07/18/HttpClient/</li><li><strong>License: </strong>This work is licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0">CC BY-NC-SA 4.0</a>.</li></ul></div></div><ul class="post-tags-box text-lg mt-1.5 flex-wrap justify-center flex md:hidden"><li class="tag-item mx-0.5"><a href="/tags/%E5%B7%A5%E5%85%B7%E9%9B%86/">#工具集</a>&nbsp;</li></ul><div class="article-nav my-8 flex justify-between items-center px-2 sm:px-6 md:px-8"><div class="article-prev border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2"><a class="prev" rel="prev" href="/2024/07/18/Knife4j/"><span class="left arrow-icon flex justify-center items-center"><i class="fa-solid fa-chevron-left"></i> </span><span class="title flex justify-center items-center"><span class="post-nav-title-item">Knife4j</span> <span class="post-nav-item">Prev posts</span></span></a></div><div class="article-next border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2"><a class="next" rel="next" href="/2024/07/18/Spring%20Task/"><span class="title flex justify-center items-center"><span class="post-nav-title-item">Spring Task</span> <span class="post-nav-item">Next posts</span> </span><span class="right arrow-icon flex justify-center items-center"><i class="fa-solid fa-chevron-right"></i></span></a></div></div><div class="comment-container px-2 sm:px-6 md:px-8 pb-8"><div class="comments-container mt-10 w-full"><div id="comment-anchor" class="w-full h-2.5"></div><div class="comment-area-title w-full my-1.5 md:my-2.5 text-xl md:text-3xl font-bold">Comments</div><div id="waline"></div><script type="module" data-swup-reload-script>import{init}from"/js/libs/waline.mjs";function loadWaline(){init({el:"#waline",serverURL:"https://comment.lusy.ink",lang:"zh-CN",dark:'body[class~="dark-mode"]',reaction:!1,requiredMeta:["nick","mail"],emoji:[]})}"undefined"!=typeof swup?loadWaline():window.addEventListener("DOMContentLoaded",loadWaline)</script></div></div></div><div class="toc-content-container"><div class="post-toc-wrap"><div class="post-toc"><div class="toc-title">On this page</div><div class="page-title">HttpClient</div><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#HttpClient"><span class="nav-text">HttpClient</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B"><span class="nav-text">简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BB%E8%A6%81%E7%89%B9%E6%80%A7"><span class="nav-text">主要特性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8"><span class="nav-text">简单使用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#HttpGet%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94%E7%9A%84%E4%B8%80%E8%88%AC%E6%AD%A5%E9%AA%A4%EF%BC%9A"><span class="nav-text">HttpGet请求响应的一般步骤：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#HttpPost%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94%E7%9A%84%E4%B8%80%E8%88%AC%E6%AD%A5%E9%AA%A4%EF%BC%9A"><span class="nav-text">HttpPost请求响应的一般步骤：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B"><span class="nav-text">使用教程</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RestTemplate"><span class="nav-text">RestTemplate</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B-1"><span class="nav-text">简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B7%E4%BD%93%E4%BD%BF%E7%94%A8"><span class="nav-text">具体使用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HttpClient%E5%8F%8A%E5%85%B6%E8%BF%9E%E6%8E%A5%E6%B1%A0%E4%BD%BF%E7%94%A8"><span class="nav-text">HttpClient及其连接池使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97"><span class="nav-text">1. 功能模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="nav-text">2. 工作原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%BC%82%E6%AD%A5%E8%AF%B7%E6%B1%82"><span class="nav-text">3. 异步请求</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="nav-text">3.1 工作原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-%E8%B0%83%E4%BC%98%E9%85%8D%E7%BD%AE"><span class="nav-text">3.2 调优配置</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%BF%9E%E6%8E%A5%E6%B1%A0"><span class="nav-text">连接池</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#IO-Reactor-%E9%85%8D%E7%BD%AE"><span class="nav-text">IO Reactor 配置</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BA%BF%E7%A8%8B%E6%B1%A0"><span class="nav-text">自定义线程池</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81"><span class="nav-text">示例代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E8%BF%9E%E6%8E%A5%E6%B1%A0"><span class="nav-text">4. 连接池</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="nav-text">4.1 基本概念</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86"><span class="nav-text">4.2 基本原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-%E5%85%B3%E9%94%AE%E7%BB%84%E4%BB%B6%E5%92%8C%E9%85%8D%E7%BD%AE"><span class="nav-text">4.3 关键组件和配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-4-%E5%B7%A5%E4%BD%9C%E6%9C%BA%E5%88%B6"><span class="nav-text">4.4 工作机制</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-5-%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81"><span class="nav-text">4.5 示例代码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-6-%E4%BD%9C%E7%94%A8%E8%8C%83%E5%9B%B4"><span class="nav-text">4.6 作用范围</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E5%92%8C-OkHttp-%E5%AF%B9%E6%AF%94"><span class="nav-text">5. 和 OkHttp 对比</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-%E8%BF%9E%E6%8E%A5%E7%AE%A1%E7%90%86%E5%92%8C%E5%A4%8D%E7%94%A8"><span class="nav-text">5.1. 连接管理和复用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-%E5%8D%8F%E8%AE%AE%E6%94%AF%E6%8C%81"><span class="nav-text">5.2. 协议支持</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-3-%E5%BC%82%E6%AD%A5%E5%A4%84%E7%90%86"><span class="nav-text">5.3. 异步处理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-4-%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6"><span class="nav-text">5.4. 缓存机制</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-5-%E8%B5%84%E6%BA%90%E6%B6%88%E8%80%97"><span class="nav-text">5.5. 资源消耗</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-6-%E6%80%BB%E7%BB%93"><span class="nav-text">5.6. 总结</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HttpClient%E5%B7%A5%E5%85%B7%E7%B1%BB%E6%A8%A1%E6%9D%BF"><span class="nav-text">HttpClient工具类模板</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#HttpClientUtil-%E7%B1%BB%E6%A6%82%E8%BF%B0"><span class="nav-text">HttpClientUtil 类概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E6%B3%A8%E9%87%8A%E4%B8%8E%E5%8A%9F%E8%83%BD%E8%AF%B4%E6%98%8E"><span class="nav-text">代码注释与功能说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95"><span class="nav-text">使用方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-text">总结</span></a></li></ol></li></ol></div></div></div></div></div></div><div class="main-content-footer"><footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color"><div class="info-container py-3 text-center"><div class="text-center">&copy; <span>2024</span> - 2025&nbsp;&nbsp;<i class="fa-regular fa-computer-classic"></i>&nbsp;&nbsp;<a href="/">Lu</a><p class="post-count space-x-0.5"><span>23 posts in total </span><span>160.9k words in total</span></p></div><script data-swup-reload-script src="https://cn.vercount.one/js"></script><div class="relative text-center lg:absolute lg:right-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-right"><span id="busuanzi_container_site_uv" class="lg:!block"><span class="text-sm">VISITOR COUNT</span> <span id="busuanzi_value_site_uv"></span> </span><span id="busuanzi_container_site_pv" class="lg:!block"><span class="text-sm">TOTAL PAGE VIEWS</span> <span id="busuanzi_value_site_pv"></span></span></div><div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left"><span class="lg:block text-sm">POWERED BY <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a></span> <span class="text-sm lg:block">THEME&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.8.2</a></span></div><div>Blog up for <span class="odometer" id="runtime_days"></span> days <span class="odometer" id="runtime_hours"></span> hrs <span class="odometer" id="runtime_minutes"></span> Min <span class="odometer" id="runtime_seconds"></span> Sec</div><script data-swup-reload-script>try{function odometer_init(){document.querySelectorAll(".odometer").forEach(e=>{new Odometer({el:e,format:"( ddd).dd",duration:200})})}odometer_init()}catch(e){}</script></div></footer></div></div><div class="post-tools"><div class="post-tools-container"><ul class="article-tools-list"><li class="right-bottom-tools page-aside-toggle"><i class="fa-regular fa-outdent"></i></li><li class="go-comment"><i class="fa-regular fa-comments"></i></li></ul></div></div><div class="right-side-tools-container"><div class="side-tools-container"><ul class="hidden-tools-list"><li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center"><i class="fa-regular fa-magnifying-glass-plus"></i></li><li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center"><i class="fa-regular fa-magnifying-glass-minus"></i></li><li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center"><i class="fa-regular fa-moon"></i></li><li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center"><i class="fa-regular fa-arrow-down"></i></li></ul><ul class="visible-tools-list"><li class="right-bottom-tools toggle-tools-list flex justify-center items-center"><i class="fa-regular fa-cog fa-spin"></i></li><li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center"><i class="arrow-up fas fa-arrow-up"></i> <span class="percent"></span></li></ul></div></div><div class="image-viewer-container"><img src=""></div><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-input-field-pre"><i class="fa-solid fa-keyboard"></i></span><div class="search-input-container"><input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="Search..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa-solid fa-times"></i></span></div><div id="search-result"><div id="no-result"><i class="fa-solid fa-spinner fa-spin-pulse fa-5x fa-fw"></i></div></div></div></div></main><script src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/libs/Swup.min.js"></script><script src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/libs/SwupSlideTheme.min.js"></script><script src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/libs/SwupScriptsPlugin.min.js"></script><script src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/libs/SwupProgressPlugin.min.js"></script><script src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/libs/SwupScrollPlugin.min.js"></script><script src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/libs/SwupPreloadPlugin.min.js"></script><script>const swup=new Swup({plugins:[new SwupScriptsPlugin({optin:!0}),new SwupProgressPlugin,new SwupScrollPlugin({offset:80}),new SwupSlideTheme({mainElement:".main-content-body"}),new SwupPreloadPlugin],containers:["#swup"]})</script><script type="module" src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/tools/imageViewer.js"></script><script type="module" src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/utils.js"></script><script type="module" src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/main.js"></script><script type="module" src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/layouts/navbarShrink.js"></script><script type="module" src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/tools/scrollTopBottom.js"></script><script type="module" src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/tools/lightDarkSwitch.js"></script><script type="module" src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/layouts/categoryList.js"></script><script type="module" src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/tools/localSearch.js"></script><script type="module" src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/tools/codeBlock.js"></script><script type="module" src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/layouts/lazyload.js"></script><script src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/tools/runtime.js"></script><script src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/libs/odometer.min.js"></script><link rel="stylesheet" href="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/assets/odometer-theme-minimal.css"><script src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/libs/Typed.min.js"></script><script type="module" src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/plugins/typed.js"></script><script type="module" src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/tools/tocToggle.js" data-swup-reload-script></script><script type="module" src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/layouts/toc.js" data-swup-reload-script></script><script type="module" src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/plugins/tabs.js" data-swup-reload-script></script><script src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/libs/moment-with-locales.min.js" data-swup-reload-script></script><script type="module" src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/layouts/essays.js" data-swup-reload-script></script></body></html>